// Generated by CoffeeScript 1.9.1
var Controller;

Controller = function(scope, window, location, users, Q) {
  var fullUrl, gD, get_data_from_api, lol, path, user;
  scope.user = {};
  scope.related = [];
  fullUrl = location.absUrl();
  path = fullUrl.substring(32);
  lol = path.split('/');
  user = lol[0];
  if (user.charAt(user.length - 1) === '#') {
    user = user.substring(0, lol[0].length - 1);
  }
  scope.user.username = user;
  get_data_from_api = function() {
    var functions;
    functions = {};
    functions.get_all_user_data = function() {
      var deferred;
      deferred = Q.defer();
      users.get_all_user_data(scope.user.username).then(function(data) {
        scope.user = data.data;
        deferred.resolve(scope.user);
      });
      return deferred.promise;
    };
    functions.get_all_users_by_genre = function(inf) {
      users.get_all_users_by_genre(scope.user.profile, scope.user.genres).then(function(data) {
        scope.related = data.data;
      });
    };
    return functions;
  };
  gD = get_data_from_api();
  gD.get_all_user_data().then(gD.get_all_users_by_genre);
};

Controller.$inject = ['$scope', '$window', '$location', 'userService', '$q'];

angular.module('app').controller('userCtrl', Controller);
